pipeline {
    agent any
    environment {
        HOME = '/tmp'
    }

    stages {
       stage('build') {
          steps {
            //  echo 'Notify GitLab'
            //  updateGitlabCommitStatus name: 'build', state: 'pending'
             echo 'build step goes here'
             sh(script: "dotnet build Transcript.API/Transcript.API.csproj -c Release -o ./dist", returnStdout: true)
            //  updateGitlabCommitStatus name: 'build', state: 'success'
          }
       }
       stage('test') {
           steps {
               echo 'Notify GitLab'
            //    updateGitlabCommitStatus name: 'test', state: 'pending'
               echo 'test step goes here'
               sh(script: 'dotnet test TranscriptAPI.Tests/TranscriptAPI.Tests.csproj -c Release --results-directory ./test-results --collect "Code Coverage" --logger "trx;LogFileName=test-results.testresults"'
, returnStdout: true)
            //    updateGitlabCommitStatus name: 'test', state: 'success'
           }
       }
       stage("Publish NUnit Test Report") {
          steps {
            nunit testResultsPattern: '**/*.testresults'
          }
       }
    }
 }